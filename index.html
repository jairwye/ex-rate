<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美元兑人民币汇率走势图</title>
    <!-- 引入ECharts图表库 -->
    <script src="js/echarts.min.js"></script>
    <!-- 引入Axios用于HTTP请求 -->
    <script src="js/axios.min.js"></script>
    <style>
        /* 基础样式设置 */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            font-family: "Microsoft YaHei", sans-serif;
            overflow: hidden;
        }
        /* 容器样式 */
        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        /* 标题样式 */
        .title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            position: relative;
            z-index: 1;
        }
        /* 更新时间显示样式 */
        .update-time {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: #aaa;
            position: relative;
            z-index: 1;
        }
        /* 图表容器样式 */
        #chart {
            width: 90%;
            height: 70%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            position: relative;
            z-index: 1;
            backdrop-filter: blur(10px);
        }
        /* 背景效果 */
        .bg-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0, 255, 0, 0.1) 0%, transparent 70%);
            animation: pulse 8s infinite alternate;
        }
        @keyframes pulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }
        /* 调试信息样式 */
        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #fff;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="bg-effect"></div>
        <h1 class="title">美元兑人民币汇率走势图</h1>
        <div class="update-time" id="updateTime">最后更新时间：</div>
        <div id="chart"></div>
    </div>
    <div class="debug-info" id="debugInfo"></div>

    <script>
        // 调试信息显示
        function debug(message) {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.textContent = message;
            console.log(message);
        }

        // 初始化图表实例
        let myChart = null;
        const chartDom = document.getElementById('chart');
        const updateTimeElement = document.getElementById('updateTime');

        // 存储历史数据的对象
        let historicalData = {
            dates: [],
            rates: []
        };

        // 从后端API获取汇率数据
        async function fetchExchangeRateData() {
            try {
                debug('正在获取数据...');
                const response = await axios.get('http://localhost:5000/api/rates');
                debug(`获取数据成功: ${JSON.stringify(response.data).substring(0, 100)}...`);
                return response.data;
            } catch (error) {
                debug(`获取数据失败: ${error.message}`);
                return null;
            }
        }

        // 初始化图表
        function initChart() {
            if (!myChart) {
                myChart = echarts.init(chartDom);
                debug('图表初始化成功');
            }
        }

        // 更新图表显示
        function updateChartDisplay(data) {
            if (!data || !data.dates || !data.rates) {
                debug('数据格式错误');
                return;
            }

            debug(`数据长度: dates=${data.dates.length}, rates=${data.rates.length}`);
            
            // 计算Y轴范围
            const minRate = Math.min(...data.rates);
            const maxRate = Math.max(...data.rates);
            const padding = 0.1;
            
            // ECharts配置项
            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        return `日期：${params[0].name}<br/>汇率：${params[0].value}`;
                    },
                    backgroundColor: 'rgba(0, 0, 0, 0.7)',
                    borderColor: 'rgba(0, 255, 0, 0.5)',
                    borderWidth: 1,
                    textStyle: {
                        color: '#fff'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: data.dates,
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    axisLabel: {
                        color: '#fff',
                        rotate: 45
                    },
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.3)'
                        }
                    },
                    axisLabel: {
                        color: '#fff',
                        formatter: '{value}'
                    },
                    splitLine: {
                        lineStyle: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        }
                    },
                    min: (minRate - padding).toFixed(4),
                    max: (maxRate + padding).toFixed(4),
                    interval: 0.1
                },
                series: [{
                    data: data.rates,
                    type: 'line',
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 8,
                    lineStyle: {
                        width: 3,
                        color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                            offset: 0,
                            color: '#00ff00'
                        }, {
                            offset: 1,
                            color: '#00ff88'
                        }])
                    },
                    itemStyle: {
                        color: '#00ff00',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: 'rgba(0, 255, 0, 0.3)'
                        }, {
                            offset: 1,
                            color: 'rgba(0, 255, 0, 0.1)'
                        }])
                    },
                    emphasis: {
                        itemStyle: {
                            color: '#fff',
                            borderColor: '#00ff00',
                            borderWidth: 2,
                            shadowColor: 'rgba(0, 255, 0, 0.5)',
                            shadowBlur: 10
                        }
                    }
                }],
                animation: true,
                animationDuration: 2000,
                animationEasing: 'cubicInOut'
            };

            try {
                myChart.setOption(option);
                debug('图表更新成功');
            } catch (error) {
                debug(`图表更新失败: ${error.message}`);
            }
            
            // 更新最后更新时间显示
            updateTimeElement.textContent = `最后更新时间：${new Date().toLocaleString()}`;
        }

        // 更新图表数据
        async function updateChart() {
            initChart();
            const data = await fetchExchangeRateData();
            if (data) {
                updateChartDisplay(data);
            }
        }

        // 页面加载完成后初始化
        window.addEventListener('load', function() {
            debug('页面加载完成');
            initChart();
            updateChart();
        });

        // 每5分钟自动更新一次数据
        setInterval(updateChart, 5 * 60 * 1000);

        // 监听窗口大小变化，调整图表大小
        window.addEventListener('resize', function() {
            if (myChart) {
                myChart.resize();
                debug('图表大小已调整');
            }
        });
    </script>
</body>
</html> 